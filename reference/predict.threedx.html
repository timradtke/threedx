<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Draw forecast sample paths from a fitted 3DX model"><title>Draw forecast sample paths from a fitted 3DX model — predict.threedx • threedx</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Draw forecast sample paths from a fitted 3DX model — predict.threedx"><meta property="og:description" content="Draw forecast sample paths from a fitted 3DX model"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">threedx</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/threedx.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/forecasting_trends.html">Forecasting Trends with `threedx`</a>
    <a class="dropdown-item" href="../articles/define_custom_innovation_functions.html">Define Custom Innovation Functions</a>
    <a class="dropdown-item" href="../articles/define_custom_loss_functions.html">Define Custom Loss Functions</a>
    <a class="dropdown-item" href="../articles/generating_diverse_weights.html">Generating Diverse Weights for Training</a>
    <a class="dropdown-item" href="../articles/working_with_forecast_sample_paths.html">Working with Forecast Sample Paths</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/timradtke/threedx/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Draw forecast sample paths from a fitted 3DX model</h1>
      <small class="dont-index">Source: <a href="https://github.com/timradtke/threedx/blob/HEAD/R/predict.R" class="external-link"><code>R/predict.R</code></a></small>
      <div class="d-none name"><code>predict.threedx.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Draw forecast sample paths from a fitted 3DX model</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for threedx</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">horizon</span>,</span>
<span>  <span class="va">n_samples</span>,</span>
<span>  <span class="va">observation_driven</span>,</span>
<span>  <span class="va">innovation_function</span>,</span>
<span>  postprocess <span class="op">=</span> <span class="va">identity</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>A fitted model object of class <code>threedx</code></p></dd>


<dt>horizon</dt>
<dd><p>An integer defining the forecast horizon</p></dd>


<dt>n_samples</dt>
<dd><p>An integer defining the number of sample paths to draw</p></dd>


<dt>observation_driven</dt>
<dd><p>Logical; if <code>TRUE</code>, sample paths are generated by
drawing from weighted historical observations directly instead of adding
innovation noise on the current mean forecast. This is similar to the
Non-Parametric Time Series forecaster (NPTS) described in
"GluonTS: Probabilistic Time Series Models in Python" (2019) by Flunkert et
al. (see https://arxiv.org/abs/1906.05264). If <code>FALSE</code>, sample paths will
be generated by adding innovation noise on top of the current weighted
average forecast.</p></dd>


<dt>innovation_function</dt>
<dd><p>A function with arguments <code>n</code> and <code>errors</code>. Must
be able to handle additional parameters via <code>...</code> to allow for potential
future changes in the set of arguments passed to
<code>innovation_function</code> by <code>predict.threedx()</code>. For examples, see
<code><a href="draw_normal_with_drift.html">draw_normal_with_drift()</a></code> or <code><a href="draw_bootstrap_weighted.html">draw_bootstrap_weighted()</a></code>.
The provided <code>innovation_function</code> must return a numeric vector of length
<code>n</code> that contains i.i.d samples that can be used for any sample path and
forecast horizon.
This argument is ignored when <code>observation_driven=TRUE</code>.</p></dd>


<dt>postprocess</dt>
<dd><p>A function that is applied on a numeric matrix of
drawn samples for a single step-ahead before the samples are used to
update the state of the model, and before outliers are removed
(if applicable). By default equal to <code><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity()</a></code>, but could also
be something like <code>function(x) pmax(x, 0)</code> to enforce a lower bound of 0,
or any other transformation of interest that returns a numeric matrix of
same dimensions as those of the input.
Note that this can cause arbitrary errors caused by the author of the
function provided to <code>postprocess</code>.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to <code>innovation_function</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A forecast object of class <code>threedx_paths</code>, which is a list of:</p><ul><li><p>A <code>paths</code> numeric matrix of dimensions <code>n_samples</code>-times-<code>horizon</code>. The
matrix stores the forecast sample paths that are the probabilistic forecast
returned by the <code>threedx</code> model. Aggregate across the first dimension to
derive expectations of the forecast distribution, aggregate across the
second dimension to derive sums over the forecast horizon.</p></li>
<li><p>The input <code>horizon</code> argument</p></li>
<li><p>The input <code>n_samples</code> argument</p></li>
<li><p>The input <code>observation_driven</code> argument</p></li>
<li><p>The model <code>model</code> provided via <code>object</code>, an object of class <code>threedx</code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>While <code>observation_driven</code> can be effective at forecasting wide
ranges of time series, the induced forecast distribution collapses to a
single point as <code>alpha</code>, <code>alpha_seasonal</code>, and <code>alpha_seasonal_decay</code>
values tend towards 1. While the corresponding point prediction may still
be optimal, the uncertainty in the forecast is likely underestimated.</p>
<p>For example, if <code>alpha = 0.98</code>, <code>alpha_seasonal=0</code>, and
<code>alpha_seasonal_decay=0</code>, the resulting forecast distribution assigns 98%
probability to the most recent observation, thus collapsing most prediction
intervals onto that point. This can be highly unrealistic for time series
whose level is changing rapidly and therefore require large <code>alpha</code> values.</p>
<p>To circumvent this issue, one can design certain conditions under
which <code>observation_driven</code> is set to <code>TRUE</code>. For example, using
<code><a href="k_largest_weights_sum_to_less_than_p_percent.html">k_largest_weights_sum_to_less_than_p_percent()</a></code>, one can check that the
learned model assigns weight to at least a few observations, and only then
set <code>observation_driven=TRUE</code>. However, if the underlying time series is
truly a random walk, <code>observation_driven=TRUE</code> will always be a poor choice
as it limits the range of possible future values too much.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="learn_weights.html">learn_weights()</a></code>, <code><a href="k_largest_weights_sum_to_less_than_p_percent.html">k_largest_weights_sum_to_less_than_p_percent()</a></code>,
<code><a href="loss_mae.html">loss_mae()</a></code>, <code><a href="loss_rmse.html">loss_rmse()</a></code>, <code><a href="draw_normal_with_zero_mean.html">draw_normal_with_zero_mean()</a></code>,
<code><a href="draw_bootstrap.html">draw_bootstrap()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9284</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">55</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span> <span class="op">+</span> <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sinpi</a></span><span class="op">(</span><span class="op">(</span><span class="fl">5</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">55</span> <span class="op">)</span><span class="op">/</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="learn_weights.html">learn_weights</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>  alphas_grid <span class="op">=</span> <span class="fu"><a href="list_sampled_alphas.html">list_sampled_alphas</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    n_target <span class="op">=</span> <span class="fl">1000L</span>,</span></span>
<span class="r-in"><span>    include_edge_cases <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  period_length <span class="op">=</span> <span class="fl">12L</span>,</span></span>
<span class="r-in"><span>  loss_function <span class="op">=</span> <span class="va">loss_mae</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">forecast_observation_driven</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  horizon <span class="op">=</span> <span class="fl">12L</span>,</span></span>
<span class="r-in"><span>  n_samples <span class="op">=</span> <span class="fl">2500L</span>,</span></span>
<span class="r-in"><span>  observation_driven <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">forecast_observation_driven</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="predict.threedx-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">forecast_latent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  horizon <span class="op">=</span> <span class="fl">12L</span>,</span></span>
<span class="r-in"><span>  n_samples <span class="op">=</span> <span class="fl">2500L</span>,</span></span>
<span class="r-in"><span>  observation_driven <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  innovation_function <span class="op">=</span> <span class="va">draw_bootstrap</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">forecast_latent</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="predict.threedx-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">forecast_latent_with_postprocessing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">model</span>,</span></span>
<span class="r-in"><span>  horizon <span class="op">=</span> <span class="fl">12L</span>,</span></span>
<span class="r-in"><span>  n_samples <span class="op">=</span> <span class="fl">2500L</span>,</span></span>
<span class="r-in"><span>  observation_driven <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  innovation_function <span class="op">=</span> <span class="va">draw_normal_with_zero_mean</span>,</span></span>
<span class="r-in"><span>  postprocess <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">forecast_latent_with_postprocessing</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="predict.threedx-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Tim Radtke.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

